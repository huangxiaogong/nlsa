"""
An Example workflow for NLSA analysis on a rayleigh benard convection dataset

Usage:
1. Specify path to NLSA root
2. Specify the configuration file
3. Run `snakemake <target>` from the shell

"""

# specify path to NLSA
nlsapath="/scratch/noah/nlsa"

import sys
sys.path.insert(0, nlsapath)
include: nlsapath + "/nlsa/recon.snakefile"
include: nlsapath + "/nlsa/diffusionmap.snakefile"

configfile: "nlsa.yaml"
workdir: "anl"

rule all:
    input: "wthermo/q200/Ee1_a0/wthermo/S1/orthog.pkl"


rule vis:
    input: "{dir}/orthog.pkl"
    output: "{dir}/vis"
    run:
        import matplotlib.pyplot as plt
        import pandas as pd
        df =  pd.read_pickle(input[0])
        df.ix[:,:30].plot(subplots=True, layout=(-1,5))
        plt.suptitle(wildcards.dir)
        plt.show()
